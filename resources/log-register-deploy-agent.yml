# Agent Log, Register & Deploy Pipeline
#
# Databricks job that handles complete agent deployment pipeline:
# 1. log_register_agent: Logs the agent to MLflow and registers it in Unity Catalog
# 2. deploy_agent: Deploys the registered agents using Agent Framework to a Databricks model serving endpoint

resources:
  jobs:
    telco_log_register_deploy_agent:
      name: telco_log_register_deploy_agent_${bundle.target}
      tasks:
        - task_key: log_register_agent
          notebook_task:
            notebook_path: ../notebooks/03_log_register_agent/log_register_agent.py
            base_parameters:
              env: ${bundle.target}
              uc_catalog: ${var.uc_catalog}
              agent_schema: ${var.agent_schema}
              data_schema: ${var.data_schema}
              model_name: ${var.model_name}
              experiment_name: ${var.experiment_name}
              disable_tools: ${var.disable_tools}
              git_commit: ${bundle.git.commit}
              
        - task_key: deploy_agent
          depends_on:
            - task_key: log_register_agent
          notebook_task:
            notebook_path: ../notebooks/04_deploy_agent/deploy_agent.py
            base_parameters:
              env: ${bundle.target}
              uc_catalog: ${var.uc_catalog}
              agent_schema: ${var.agent_schema}
              model_name: ${var.model_name}
              endpoint_name: ${var.endpoint_name}
              scale_to_zero_enabled: ${var.scale_to_zero_enabled}
              workload_size: ${var.workload_size}
              git_commit: ${bundle.git.commit}
